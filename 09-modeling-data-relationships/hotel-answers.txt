--A guest who exists in the database and has not booked a room.

SELECT g.first_name, g.last_name FROM guests AS g LEFT OUTER JOIN bookings AS b ON
g.first_name = b.guest_first AND g.last_name = b.guest_last WHERE b IS NULL;

OUTPUT:

first_name	 last_name
Joe	          Schmoe


--Bookings for a guest who has booked two rooms for the same dates.

SELECT DISTINCT ON (b.check_in_date, b.check_out_date) COUNT(room_num) AS room_count, b.check_in_date, b.check_out_date,
g.first_name, g.last_name FROM guests AS g RIGHT OUTER JOIN bookings AS b ON g.first_name = b.guest_first AND
g.last_name = b.guest_last GROUP BY g.first_name, g.last_name, b.check_in_date, b.check_out_date HAVING COUNT(room_num) >= 2;

OUTPUT:

room_count	   check_in_date	              check_out_date	           first_name	   last_name
2	             2019-05-01T00:00:00.000Z	    2019-05-04T00:00:00.000Z	 John	         Smith


--Bookings for a guest who has booked one room several times on different dates.

SELECT string_agg(CAST(bookings.* AS VARCHAR),',') AS bookings, guests.first_name, guests.last_name FROM bookings
JOIN guests ON bookings.guest_first = guests.first_name AND bookings.guest_last = guests.last_name
GROUP BY guests.first_name, guests.last_name, bookings.room_num HAVING COUNT(bookings.room_num) >= 2;

OUTPUT:

bookings                                                                 	first_name	last_name
(2,Jane,Doe,2,2019-05-01,2019-05-04)(2,Jane,Doe,2,2019-07-01,2019-07-04)	Jane	      Doe


--The number of unique guests who have booked the same room.

SELECT bookings.room_num, COUNT (DISTINCT(bookings.guest_id)) AS distinct_guests FROM bookings GROUP BY room_num;

OUTPUT:

room_num	distinct_guests
1	        1
2	        1
3	        2
